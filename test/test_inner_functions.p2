
import core.intrinsics

 // Module scope

int g1

gf1 = {}

struct Struct = [
    // Can see struct scope + module scope
    int s1
    f = {
        // Struct member func
        // Can see func scope + struct scope + module scope

        inner = {
            // inner function
            // Can see this scope only

            int i1

            i1  // ok
            //i2  // nope
            //s1  // nope
            //s2  // nope

            int i2
        }
    }
    int s2
]

func = {    // {->}
    // Can only see vars and funcs at this scope and module scope

    int func1
    f1 = {
        // Can only see vars and funcs at this scope and module scope
        int f1var = 1

        f1var += 1  // ok
    }

    func1 += 1  // ok
    g1 += 1     // ok
    g2 += 1     // ok

    inner = { // {->}
        // Can only see vars and funcs at this scope and module scope

        int inn1
        f3 = {}

        inn1 += 1  // ok
        //inn2 += 1  // nope
        //f1var += 1  // nope
        //func1 += 1  // nope
        //func2 += 1  // nope
        g1 += 1     // ok
        g2 += 1     // ok

        gf1()     // ok
        gf2()     // ok
        //f1()      // nope
        //f2()      // nope
        f3()        // ok

        int inn2
    }
    int func2
    f2 = {}

    func2 += 1 // ok

    inner()
}
func2 = {
    inner = {}
    inner()
}

int g2
gf2 = {}

testClosures = {
    var closure1 = { int a -> return 2 }
    var closure2 = { int a -> return 3 }
    {int->int} funcptr = closure2

    assert 2 == closure1(1)
    assert 3 == closure2(1)
    assert 3 == funcptr(1)
}

public testInnerFunctions = {
    testClosures()

    Struct s
    func()      // ok
    func2()
    //inner()   // not visible
}
